<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Faster Dose Transition Pathways (DTP) calculation — calculate_dtps • precautionary</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Faster Dose Transition Pathways (DTP) calculation — calculate_dtps" />
<meta property="og:description" content="This function reimplements dtpcrm::calculate_dtps with algorithmic
improvements that achieve signficant speedups, rendering it suitable for
comprehensive enumeration of all paths of a trial." />
<meta property="og:image" content="/reference/figures/card.png" />
<meta property="og:image:alt" content="Logo for precautionary package" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@davidcnorrismd" />
<meta name="twitter:site" content="@davidcnorrismd" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">precautionary</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.3-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/DTP-vs-Korn94.html">DTP-vs-Korn94</a>
    </li>
    <li>
      <a href="../articles/FDA-proactive.html">How FDA can vet dose-escalation trials for safety</a>
    </li>
    <li>
      <a href="../articles/Intro.html">Introduction to package 'precautionary'</a>
    </li>
    <li>
      <a href="../articles/MCSE-Free.html">MCSE-Free CRM Performance and Safety Assessment</a>
    </li>
    <li>
      <a href="../articles/Safety-Schematic-via-DTP.html">Generalized dose-escalation safety schematics via Dose Transition Pathways (DTP)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Faster Dose Transition Pathways (DTP) calculation</h1>
    
    <div class="hidden name"><code>calculate_dtps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function reimplements <code><a href='https://rdrr.io/pkg/dtpcrm/man/calculate_dtps.html'>dtpcrm::calculate_dtps</a></code> with algorithmic
improvements that achieve signficant speedups, rendering it suitable for
comprehensive enumeration of all paths of a trial.</p>
    </div>

    <pre class="usage"><span class='fu'>calculate_dtps</span><span class='op'>(</span>
  <span class='va'>next_dose</span>,
  <span class='va'>cohort_sizes</span>,
  dose_func <span class='op'>=</span> <span class='va'>applied_crm</span>,
  <span class='va'>...</span>,
  mc.cores <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"mc.cores"</span>, <span class='fl'>2L</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>next_dose</th>
      <td><p>The root dose of the trial-path tree to be computed</p></td>
    </tr>
    <tr>
      <th>cohort_sizes</th>
      <td><p>An integer vector of cohort sizes, with length equal to
the maximum number of cohorts that may be enrolled. (Thus, <code><a href='https://rdrr.io/r/base/sum.html'>sum(cohort_sizes)</a></code>
is the trial's maximum enrollment.)</p></td>
    </tr>
    <tr>
      <th>dose_func</th>
      <td><p>An adapter function</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Ultimately passed to <code>.conduct_dose_finding_cohorts</code>, whence
it ends up informing the <code>dose_func</code>. Thanks to the method chaining of
R6 class <code>Crm</code>, the role of this argument has been sharply curtailed
compared with the original <code><a href='https://rdrr.io/pkg/dtpcrm/man/calculate_dtps.html'>dtpcrm::calculate_dtps</a></code>. Here, we use it
only for selecting optional CRM numerical implementations via <code>impl</code>.</p></td>
    </tr>
    <tr>
      <th>mc.cores</th>
      <td><p>Number of logical cores available for parallelizing DTP computation.
Setting this to 1 prevents chunking of the computation.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>data.table</code> listing trial pathways</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>In accord with the chosen DTP representation of <span class="pkg">dtpcrm</span>, we pursue a tabular
listing of all paths, inclusive of the degeneracies engendered by early stopping.
During the DTP computation, however, these degeneracies are recognized and
handled efficiently here, avoiding costly reduplication of CRM model runs.
The algorithm employs a top-to-bottom scan of the path table, in the
lexicographic order of increasing toxicity counts which naturally arises from
<code>expand.grid</code> used here and in the original <code><a href='https://rdrr.io/pkg/dtpcrm/man/calculate_dtps.html'>dtpcrm::calculate_dtps</a></code>.
The early termination of any path in the course of this scan may then be carried
forward through all subsequent paths which share the same dose assignments and
toxicity counts. (In the case of early termination specifically for excessive
toxicity, this principle could also be applied 'one level up', possibly capturing
some additional efficiencies. But implementing this safely would require greater
control over early-termination semantics than <span class="pkg">dtpcrm</span> --- or indeed perhaps
any R package --- seems capable of achieving. So it is not implemented here.)</p>
<p>The substantial efficiencies (3.5x speedup of VIOLA trial DTP) obtained in the
above-described scan can readily be preserved under coarse-grained parallelization,
on account of the DTP table's recursive structure. If the first cohort has size $$n$$,
then it gives rise to $$n+1$$ independent chunks within which the scan logic applies,
one chunk for each possible toxicity count in $$\{0,1,...,n\}$$.
This principle applies also at the level of the next cohort, and so on. With each
such refinement to the chunking of the DTP calculation, some re-work is introduced
where the same early termination even is discovered independently in several chunks.
But given that few reasonable trial designs will have a substantial number of paths
terminating before 6 patients, this re-work should be irrelevant to parallelization
of DTP computation over the 4--16 threads of a single modern, multicore processor.
(Consider that chunking just the first 2 cohorts of a trial with cohort size 3
yields $(3+1)^2=16$ chunks.)</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Adapted by David C. Norris from original <code><a href='https://rdrr.io/pkg/dtpcrm/man/calculate_dtps.html'>dtpcrm::calculate_dtps</a></code></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## VIOLA trial</span>
<span class='va'>prior.DLT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.03</span>, <span class='fl'>0.07</span>, <span class='fl'>0.12</span>, <span class='fl'>0.20</span>, <span class='fl'>0.30</span>, <span class='fl'>0.40</span>, <span class='fl'>0.52</span><span class='op'>)</span>
<span class='va'>prior.var</span> <span class='op'>&lt;-</span> <span class='fl'>0.75</span>

<span class='va'>stop_func</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='stop_for_excess_toxicity_empiric.html'>stop_for_excess_toxicity_empiric</a></span><span class='op'>(</span><span class='va'>x</span>,
                                        tox_lim <span class='op'>=</span> <span class='fl'>0.3</span>,
                                        prob_cert <span class='op'>=</span> <span class='fl'>0.72</span>,
                                        dose <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='va'>y</span><span class='op'>$</span><span class='va'>stop</span><span class='op'>)</span><span class='op'>{</span>
    <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>y</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>stop_for_consensus_reached</span><span class='op'>(</span><span class='va'>x</span>, req_at_mtd <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>
  <span class='op'>}</span>
<span class='op'>}</span>

<span class='va'>crm</span> <span class='op'>&lt;-</span> <span class='va'><a href='Crm-class.html'>Crm</a></span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span>skeleton <span class='op'>=</span> <span class='va'>prior.DLT</span>,
               scale <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>prior.var</span><span class='op'>)</span>,
               target <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span><span class='op'>$</span>
  <span class='fu'>stop_func</span><span class='op'>(</span><span class='va'>stop_func</span><span class='op'>)</span><span class='op'>$</span>
  <span class='fu'>no_skip_esc</span><span class='op'>(</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>$</span>
  <span class='fu'>no_skip_deesc</span><span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>$</span>
  <span class='fu'>global_coherent_esc</span><span class='op'>(</span><span class='cn'>TRUE</span><span class='op'>)</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span> <span class='co'># don't overtax CRAN servers</span>
<span class='va'>restore</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>mc.cores <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='co'># you can reasonably set as high as detectCores()</span>
<span class='va'>dtps</span> <span class='op'>&lt;-</span> <span class='fu'>calculate_dtps</span><span class='op'>(</span>next_dose <span class='op'>=</span> <span class='fl'>3</span>,
                       cohort_sizes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>7</span><span class='op'>)</span>,
                       dose_func <span class='op'>=</span> <span class='va'>crm</span><span class='op'>$</span><span class='va'>applied</span>,
                       impl <span class='op'>=</span> <span class='st'>"rusti"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>mc.cores <span class='op'>=</span> <span class='va'>restore</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David C. Norris.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


